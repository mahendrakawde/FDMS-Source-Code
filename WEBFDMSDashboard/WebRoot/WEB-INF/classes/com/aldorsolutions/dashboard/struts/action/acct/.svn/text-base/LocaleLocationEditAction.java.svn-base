/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package com.aldorsolutions.dashboard.struts.action.acct;

import java.util.ArrayList;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;



import com.aldorsolutions.dashboard.struts.form.acct.LocaleLocationEditForm;
import com.aldorsolutions.webfdms.admin.user.bean.UserManagerBean;
import com.aldorsolutions.webfdms.admin.user.dao.UserDAO;
import com.aldorsolutions.webfdms.admin.user.model.UserLocaleDTO;
import com.aldorsolutions.webfdms.admin.user.model.UserLocationDTO;
import com.aldorsolutions.webfdms.beans.DbUserSession;
import com.aldorsolutions.webfdms.util.SessionValueKeys;


/** 
 * MyEclipse Struts
 * Creation date: 06-28-2007
 * 
 * XDoclet definition:
 * @struts.action path="/localeLocationEdit" name="localeLocationForm" input="/acct/localeLocationEdit.jsp" scope="request" validate="true"
 */
public class LocaleLocationEditAction extends Action {
	/*
	 * Generated Methods
	 */	
	
	/** 
	 * Method execute
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 */
	public ActionForward execute(ActionMapping mapping, ActionForm form, HttpServletRequest request,
			HttpServletResponse response) {
		LocaleLocationEditForm localeLocationEditForm = (LocaleLocationEditForm) form;
		
		HttpSession session = request.getSession();
		DbUserSession user = (DbUserSession) session.getAttribute(SessionValueKeys.DB_USER);

		
	   UserManagerBean uMgr = new UserManagerBean();
	   ArrayList <UserLocationDTO> locations = uMgr.getLocationsOfUser( user.getDbLookup(), (int) user.getId(), 
					user.getCompanyID(), user.getRegion() ); 
	   ArrayList <UserLocaleDTO> locales = uMgr.getLocalesOfUser( user.getDbLookup(), (int) user.getId(), 
					user.getCompanyID(), user.getRegion());
	   
        UserDAO userDAO = new UserDAO();
        ArrayList <UserLocaleDTO> userLocales = userDAO.getUserLocales(user.getId());
        ArrayList <UserLocaleDTO> rUserLocales = new ArrayList<UserLocaleDTO>();
        for (UserLocaleDTO locale: locales){
        	for (UserLocaleDTO userLocale: userLocales ){
        		  if ( userLocale.getLocaleId().equalsIgnoreCase(locale.getLocaleId()) ){
        			  userLocale.setName(locale.getName());
        			  userLocale.setCompanyId(locale.getCompanyId());
        			  rUserLocales.add(userLocale);
        			  break;
        		  }
        	}
        }		
		
        session.setAttribute("ADMIN_LOCATIONS", locations);
        session.setAttribute("ADMIN_LOCALES", rUserLocales);	        
    	
    	String js = uMgr.createLocaleJavascript ( locations, null );
    	localeLocationEditForm.setLocaleMapJavascript(js);	
    	
		return ( mapping.findForward("localeLocationList") );
	}
}