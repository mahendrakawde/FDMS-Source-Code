/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 * CJongs
 */
package fdms.ui.struts.action;

import java.util.ArrayList;
import java.util.List;
import java.util.Locale;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.log4j.Logger;
import org.apache.struts.action.Action;
import org.apache.struts.action.ActionErrors;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.apache.struts.action.ActionMessage;
import org.apache.struts.action.ActionMessages;
import org.apache.struts.util.LabelValueBean;

import com.aldorassist.webfdms.model.LocaleDTO;
import com.aldorsolutions.webfdms.beans.DbArrangers;
import com.aldorsolutions.webfdms.beans.DbCase;
import com.aldorsolutions.webfdms.beans.DbLocation;
import com.aldorsolutions.webfdms.beans.DbUser;
import com.aldorsolutions.webfdms.beans.DbUserSession;
import com.aldorsolutions.webfdms.beans.DbVitalsFirstCall;
import com.aldorsolutions.webfdms.beans.FdmsDb;
import com.aldorsolutions.webfdms.common.Constants;
import com.aldorsolutions.webfdms.database.DatabaseTransaction;
import com.aldorsolutions.webfdms.database.PersistenceException;
import com.aldorsolutions.webfdms.locale.bean.LocaleManagerBean;
import com.aldorsolutions.webfdms.util.CsvTable;
import com.aldorsolutions.webfdms.util.FormatNumber;
import com.aldorsolutions.webfdms.util.FormatString;
import com.aldorsolutions.webfdms.util.OptionsList;
import com.aldorsolutions.webfdms.util.SessionHelpers;
import com.aldorsolutions.webfdms.util.UtilSingleton;

import fdms.ui.struts.form.CreditCardForm;
import fdms.ui.struts.form.MovingCaseForm;


/** 
 * MyEclipse Struts
 * Creation date: 04-17-2007
 * 
 * XDoclet definition:
 * @struts.action validate="true"
 * @struts.action-forward name="failed" path="/login.jsp"
 * @struts.action-forward name="success" path="/main.jsp"
 */
public class  ShowCreditCard extends Action {
	/*
	 * Generated Methods
	 */
	
	private Logger logger = Logger.getLogger(ShowCreditCard.class.getName());

	/** 
	 * Method execute
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 */
	public ActionForward execute(ActionMapping mapping, ActionForm actionForm, HttpServletRequest request,
			HttpServletResponse response) throws javax.servlet.ServletException, java.io.IOException {
		
		
		DbUserSession sessionUser = SessionHelpers.getUserSession(request);
		CreditCardForm form = (CreditCardForm) actionForm;
		form.setFirstname("John");
        form.setLastname("Doe");
        form.setCardNumber("5454545454545454");
        form.setExpirationDate("0913");
        form.setCvv("333");
        form.setAddress("100 Street st");
        form.setCity("city");
        form.setState("state");
        form.setZip("75074");
        form.setAmount("10");
        DatabaseTransaction t = null;
        DbCase theCase = null;
        int vitalsId = 0;
        ArrayList <LabelValueBean> array = new ArrayList <LabelValueBean> ();
        array.add ( new LabelValueBean("Not case related", "0") );
        if (SessionHelpers.getVitalsIdFromSession(request, sessionUser) != 0){
        	vitalsId = SessionHelpers.getVitalsIdFromSession(request, sessionUser);
        }
        if (vitalsId != 0) {
	        try {
				t = (DatabaseTransaction)DatabaseTransaction.getTransaction(sessionUser);
				theCase 	= FdmsDb.getInstance().getCase(t,vitalsId);
				
				
				array.add ( new LabelValueBean(theCase.getFirstName()+" "+theCase.getLastName(), String.valueOf(vitalsId)) );
				
				
	        } catch(Exception pe) {
	            logger.error("Exception in ShowCreditCard.doPerform. ", pe);
	        } finally {
	            if (t != null) {
	            	t.closeConnection();
	            	t = null;
	            }
	        }	
        }
        form.setCaseList(array);
		return ( mapping.findForward("showCreditCardJsp") );
	}
	

}